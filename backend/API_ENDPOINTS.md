# API Endpoints Documentation

## T·ªïng quan

T√†i li·ªáu n√†y m√¥ t·∫£ t·∫•t c·∫£ c√°c API endpoints c√≥ s·∫µn trong h·ªá th·ªëng qu·∫£n l√Ω ho·∫°t ƒë·ªông sinh vi√™n PBL6.

**Base URL**: `/api`

**Server**: `http://localhost:5000` (Development)

---

## üìë M·ª•c l·ª•c

1. [Authentication & Users](#authentication--users)
2. [Profiles](#profiles)
3. [Organization](#organization)
4. [Activities](#activities)
5. [Points & Feedback](#points--feedback)
6. [System & Permissions](#system--permissions)
7. [Statistics](#statistics)

---

## üîê Authentication & Users

### Auth Routes (`/api/auth`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| POST | `/api/auth/login` | ƒêƒÉng nh·∫≠p | ‚ùå | Public |
| POST | `/api/auth/register` | ƒêƒÉng k√Ω t√†i kho·∫£n m·ªõi | ‚ùå | Public |
| POST | `/api/auth/create-user` | Admin t·∫°o t√†i kho·∫£n user m·ªõi | ‚úÖ | admin |
| GET | `/api/auth/profile` | L·∫•y th√¥ng tin profile c·ªßa user hi·ªán t·∫°i | ‚úÖ | All authenticated |
| POST | `/api/auth/forgot-password` | Qu√™n m·∫≠t kh·∫©u - g·ª≠i email reset | ‚ùå | Public |
| POST | `/api/auth/reset-password` | ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u b·∫±ng token | ‚ùå | Public |

**Request Body - Login:**
```json
{
  "username": "user1",
  "password": "password123"
}
```

**Request Body - Register:**
```json
{
  "username": "newuser",
  "password": "password123"
}
```

**Request Body - Admin Create-User:**
```json
{
  "username": "new_username",
  "password": "password123",
  "roleName": "student"
}
```

**Request Body - Forgot Password:**
```json
{
  "username": "user1"
}
```

**Response - Forgot Password (Success):**
```json
{
  "success": true,
  "message": "Password reset link has been sent to your email."
}
```

**Request Body - Reset Password:**
```json
{
  "token": "reset_token_from_email",
  "newPassword": "newpassword123"
}
```

**Response - Reset Password (Success):**
```json
{
  "success": true,
  "message": "Password has been reset successfully"
}
```

---

### User Routes (`/api/users`)

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/users` | L·∫•y danh s√°ch t·∫•t c·∫£ ng∆∞·ªùi d√πng | ‚úÖ | `user:READ` |
| GET | `/api/users/:id` | L·∫•y chi ti·∫øt ng∆∞·ªùi d√πng theo ID | ‚úÖ | - |
| POST | `/api/users` | T·∫°o t√†i kho·∫£n ng∆∞·ªùi d√πng m·ªõi | ‚úÖ | `user:CREATE` |
| PUT | `/api/users/:id` | C·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |
| DELETE | `/api/users/:id` | X√≥a t√†i kho·∫£n ng∆∞·ªùi d√πng | ‚úÖ | `user:DELETE` |
| PUT | `/api/users/:id/lock` | Kh√≥a t√†i kho·∫£n ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |
| PUT | `/api/users/:id/unlock` | M·ªü kh√≥a t√†i kho·∫£n ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |

#### User Role Management

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/users/:id/roles` | L·∫•y danh s√°ch vai tr√≤ c·ªßa ng∆∞·ªùi d√πng | ‚úÖ | `user:READ` |
| POST | `/api/users/:id/roles` | G√°n vai tr√≤ cho ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |
| DELETE | `/api/users/:id/roles/:roleId` | X√≥a vai tr√≤ kh·ªèi ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |

#### User Action Override Management

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| POST | `/api/users/:id/actions/override` | Th√™m action override cho ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |
| DELETE | `/api/users/:id/actions/override/:actionId` | X√≥a action override kh·ªèi ng∆∞·ªùi d√πng | ‚úÖ | `user:UPDATE` |

**Request Body - Create User:**
```json
{
  "username": "new_username",
  "password": "password123",
  "roleName": "student"
}
```

**Request Body - Assign Role:**
```json
{
  "role_id": "role_uuid_here",
  "org_unit_id": "org_unit_uuid_here" // n·∫øu c·∫ßn g√°n role theo t·ªï ch·ª©c
}
```

---

## üë§ Profiles

### Student Profile Routes (`/api/student-profiles`)

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/student-profiles` | L·∫•y t·∫•t c·∫£ h·ªì s∆° sinh vi√™n | ‚úÖ | `student_profile:READ` |
| GET | `/api/student-profiles/:id` | L·∫•y h·ªì s∆° sinh vi√™n theo ID | ‚úÖ | - |
| GET | `/api/student-profiles/user/:userId` | L·∫•y h·ªì s∆° sinh vi√™n theo User ID | ‚úÖ | - |
| GET | `/api/student-profiles/student-number/:studentNumber` | L·∫•y h·ªì s∆° theo m√£ sinh vi√™n | ‚úÖ | - |
| GET | `/api/student-profiles/class/:classId/students` | L·∫•y danh s√°ch sinh vi√™n theo l·ªõp | ‚úÖ | `student_profile:READ` |
| GET | `/api/student-profiles/class-monitors` | L·∫•y danh s√°ch t·∫•t c·∫£ l·ªõp tr∆∞·ªüng | ‚úÖ | `student_profile:READ` |
| POST | `/api/student-profiles` | T·∫°o h·ªì s∆° sinh vi√™n m·ªõi | ‚úÖ | `student_profile:CREATE` |
| PUT | `/api/student-profiles/:id` | C·∫≠p nh·∫≠t h·ªì s∆° sinh vi√™n | ‚úÖ | `student_profile:UPDATE` |
| DELETE | `/api/student-profiles/:id` | X√≥a h·ªì s∆° sinh vi√™n | ‚úÖ | `student_profile:DELETE` |
| PUT | `/api/student-profiles/:id/set-monitor` | ƒê·∫∑t l√†m l·ªõp tr∆∞·ªüng | ‚úÖ | `student_profile:UPDATE` |
| PUT | `/api/student-profiles/:id/unset-monitor` | H·ªßy ch·ª©c l·ªõp tr∆∞·ªüng | ‚úÖ | `student_profile:UPDATE` |

**Request Body - Create Student Profile:**
```json
{
  "userId": "user_uuid_here",
  "studentNumber": "102220095",
  "classId": "class_uuid_here",
  "cohortId": "cohort_uuid_here",
  "phone": "0123456789",
  "address": "H√† N·ªôi"
}
```

---

### Staff Profile Routes (`/api/staff-profiles`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/staff-profiles` | L·∫•y t·∫•t c·∫£ h·ªì s∆° c√°n b·ªô | ‚úÖ | admin, ctsv |
| GET | `/api/staff-profiles/:id` | L·∫•y h·ªì s∆° c√°n b·ªô theo ID | ‚úÖ | - |
| GET | `/api/staff-profiles/user/:userId` | L·∫•y h·ªì s∆° c√°n b·ªô theo User ID | ‚úÖ | - |
| GET | `/api/staff-profiles/staff-number/:staffNumber` | L·∫•y h·ªì s∆° theo m√£ c√°n b·ªô | ‚úÖ | - |
| GET | `/api/staff-profiles/org-unit/:orgUnitId/staff` | L·∫•y danh s√°ch c√°n b·ªô theo ƒë∆°n v·ªã | ‚úÖ | - |
| POST | `/api/staff-profiles` | T·∫°o h·ªì s∆° c√°n b·ªô m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/staff-profiles/:id` | C·∫≠p nh·∫≠t h·ªì s∆° c√°n b·ªô | ‚úÖ | - |
| DELETE | `/api/staff-profiles/:id` | X√≥a h·ªì s∆° c√°n b·ªô | ‚úÖ | admin, ctsv |

**Request Body - Create Staff Profile:**
```json
{
  "userId": "user_uuid_here",
  "staffNumber": "STAFF001",
  "orgUnitId": "org_unit_uuid_here",
  "position": "Gi·∫£ng vi√™n",
  "phone": "0123456789",
  "address": "H√† N·ªôi"
}
```

---

### Student Cohort Routes (`/api/student-cohorts`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/student-cohorts` | L·∫•y t·∫•t c·∫£ m·ªëi quan h·ªá sinh vi√™n-kh√≥a | ‚úÖ | admin, ctsv, teacher |
| GET | `/api/student-cohorts/:id` | L·∫•y quan h·ªá sinh vi√™n-kh√≥a theo ID | ‚úÖ | - |
| GET | `/api/student-cohorts/student/:studentId` | L·∫•y c√°c kh√≥a c·ªßa sinh vi√™n | ‚úÖ | - |
| GET | `/api/student-cohorts/cohort/:cohortId` | L·∫•y sinh vi√™n theo kh√≥a | ‚úÖ | - |
| POST | `/api/student-cohorts` | T·∫°o m·ªëi quan h·ªá sinh vi√™n-kh√≥a m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/student-cohorts/:id` | C·∫≠p nh·∫≠t m·ªëi quan h·ªá | ‚úÖ | admin, ctsv |
| DELETE | `/api/student-cohorts/:id` | X√≥a m·ªëi quan h·ªá | ‚úÖ | admin, ctsv |

---

### PVCD Record Routes (`/api/pvcd-records`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/pvcd-records` | L·∫•y t·∫•t c·∫£ b·∫£n ghi PVCD | ‚úÖ | admin, ctsv, teacher |
| GET | `/api/pvcd-records/:id` | L·∫•y b·∫£n ghi PVCD theo ID | ‚úÖ | - |
| GET | `/api/pvcd-records/student/:studentId` | L·∫•y b·∫£n ghi PVCD theo sinh vi√™n | ‚úÖ | - |
| GET | `/api/pvcd-records/year/:year` | L·∫•y b·∫£n ghi PVCD theo nƒÉm | ‚úÖ | admin, ctsv, teacher |
| POST | `/api/pvcd-records` | T·∫°o b·∫£n ghi PVCD m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/pvcd-records/:id` | C·∫≠p nh·∫≠t b·∫£n ghi PVCD | ‚úÖ | admin, ctsv |
| PUT | `/api/pvcd-records/:id/points` | C·∫≠p nh·∫≠t ƒëi·ªÉm PVCD | ‚úÖ | admin, ctsv |
| DELETE | `/api/pvcd-records/:id` | X√≥a b·∫£n ghi PVCD | ‚úÖ | admin, ctsv |

**Request Body - Create PVCD Record:**
```json
{
  "studentId": "student_uuid_here",
  "year": 2024,
  "semester": 1,
  "points": 15,
  "note": "ƒêi·ªÉm PVCD h·ªçc k·ª≥ 1"
}
```

---

## üè¢ Organization

### Faculty Routes (`/api/faculties`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/faculties` | L·∫•y t·∫•t c·∫£ khoa | ‚ùå | Public |
| GET | `/api/faculties/:id` | L·∫•y th√¥ng tin khoa theo ID | ‚ùå | Public |
| GET | `/api/faculties/:id/classes` | L·∫•y danh s√°ch l·ªõp c·ªßa khoa | ‚ùå | Public |
| POST | `/api/faculties` | T·∫°o khoa m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/faculties/:id` | C·∫≠p nh·∫≠t th√¥ng tin khoa | ‚úÖ | admin, ctsv |
| DELETE | `/api/faculties/:id` | X√≥a khoa | ‚úÖ | admin, ctsv |

**Request Body - Create Faculty:**
```json
{
  "name": "Khoa C√¥ng ngh·ªá th√¥ng tin",
  "code": "CNTT",
  "description": "Khoa C√¥ng ngh·ªá th√¥ng tin"
}
```

---

### Field Routes (`/api/fields`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/fields` | L·∫•y t·∫•t c·∫£ ng√†nh h·ªçc | ‚ùå | Public |
| GET | `/api/fields/:id` | L·∫•y th√¥ng tin ng√†nh h·ªçc theo ID | ‚ùå | Public |
| POST | `/api/fields` | T·∫°o ng√†nh h·ªçc m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/fields/:id` | C·∫≠p nh·∫≠t th√¥ng tin ng√†nh h·ªçc | ‚úÖ | admin, ctsv |
| DELETE | `/api/fields/:id` | X√≥a ng√†nh h·ªçc | ‚úÖ | admin, ctsv |

**Request Body - Create Field:**
```json
{
  "name": "C√¥ng ngh·ªá th√¥ng tin",
  "code": "CNTT",
  "description": "Ng√†nh C√¥ng ngh·ªá th√¥ng tin"
}
```

---

### Cohort Routes (`/api/cohorts`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/cohorts` | L·∫•y t·∫•t c·∫£ kh√≥a h·ªçc | ‚ùå | Public |
| GET | `/api/cohorts/:id` | L·∫•y th√¥ng tin kh√≥a h·ªçc theo ID | ‚ùå | Public |
| GET | `/api/cohorts/year/:year` | L·∫•y kh√≥a h·ªçc theo nƒÉm | ‚ùå | Public |
| GET | `/api/cohorts/:id/classes` | L·∫•y danh s√°ch l·ªõp c·ªßa kh√≥a | ‚ùå | Public |
| GET | `/api/cohorts/:id/students` | L·∫•y danh s√°ch sinh vi√™n c·ªßa kh√≥a | ‚ùå | Public |
| POST | `/api/cohorts` | T·∫°o kh√≥a h·ªçc m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/cohorts/:id` | C·∫≠p nh·∫≠t th√¥ng tin kh√≥a h·ªçc | ‚úÖ | admin, ctsv |
| DELETE | `/api/cohorts/:id` | X√≥a kh√≥a h·ªçc | ‚úÖ | admin, ctsv |

**Request Body - Create Cohort:**
```json
{
  "name": "Kh√≥a 2022",
  "year": 2022,
  "description": "Kh√≥a h·ªçc 2022"
}
```

---

### Class Routes (`/api/classes`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/classes` | L·∫•y t·∫•t c·∫£ l·ªõp h·ªçc | ‚ùå | Public |
| GET | `/api/classes/:id` | L·∫•y th√¥ng tin l·ªõp h·ªçc theo ID | ‚ùå | Public |
| GET | `/api/classes/faculty/:facultyId/classes` | L·∫•y danh s√°ch l·ªõp theo khoa | ‚ùå | Public |
| GET | `/api/classes/cohort/:cohortId/classes` | L·∫•y danh s√°ch l·ªõp theo kh√≥a | ‚ùå | Public |
| GET | `/api/classes/:id/students` | L·∫•y danh s√°ch sinh vi√™n trong l·ªõp | ‚ùå | Public |
| POST | `/api/classes` | T·∫°o l·ªõp h·ªçc m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/classes/:id` | C·∫≠p nh·∫≠t th√¥ng tin l·ªõp h·ªçc | ‚úÖ | admin, ctsv |
| DELETE | `/api/classes/:id` | X√≥a l·ªõp h·ªçc | ‚úÖ | admin, ctsv |

**Request Body - Create Class:**
```json
{
  "name": "CNTT01",
  "code": "CNTT01",
  "facultyId": "faculty_uuid_here",
  "cohortId": "cohort_uuid_here",
  "description": "L·ªõp CNTT01"
}
```

---

### Organization Unit Routes (`/api/org-units`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/org-units` | L·∫•y t·∫•t c·∫£ ƒë∆°n v·ªã t·ªï ch·ª©c | ‚ùå | Public |
| GET | `/api/org-units/:id` | L·∫•y th√¥ng tin ƒë∆°n v·ªã theo ID | ‚ùå | Public |
| GET | `/api/org-units/type/:type` | L·∫•y ƒë∆°n v·ªã theo lo·∫°i | ‚ùå | Public |
| GET | `/api/org-units/:id/staff` | L·∫•y danh s√°ch c√°n b·ªô c·ªßa ƒë∆°n v·ªã | ‚ùå | Public |
| POST | `/api/org-units` | T·∫°o ƒë∆°n v·ªã t·ªï ch·ª©c m·ªõi | ‚úÖ | admin, ctsv |
| PUT | `/api/org-units/:id` | C·∫≠p nh·∫≠t th√¥ng tin ƒë∆°n v·ªã | ‚úÖ | admin, ctsv |
| DELETE | `/api/org-units/:id` | X√≥a ƒë∆°n v·ªã t·ªï ch·ª©c | ‚úÖ | admin, ctsv |
| PUT | `/api/org-units/:id/set-leader` | ƒê·∫∑t tr∆∞·ªüng ƒë∆°n v·ªã | ‚úÖ | admin, ctsv |

**Request Body - Create Organization Unit:**
```json
{
  "name": "Khoa C√¥ng ngh·ªá th√¥ng tin",
  "code": "CNTT",
  "type": "faculty",
  "description": "Khoa C√¥ng ngh·ªá th√¥ng tin"
}
```

**Request Body - Set Leader:**
```json
{
  "staffId": "staff_uuid_here"
}
```

---

## üéØ Activities

### Activity Routes (`/api/activities`)

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/activities` | L·∫•y t·∫•t c·∫£ ho·∫°t ƒë·ªông | ‚ùå | - (Public) |
| GET | `/api/activities/my/activities` | L·∫•y ho·∫°t ƒë·ªông c·ªßa sinh vi√™n hi·ªán t·∫°i | ‚úÖ | - (Own data) |
| GET | `/api/activities/student/:studentId` | L·∫•y ho·∫°t ƒë·ªông c·ªßa m·ªôt sinh vi√™n c·ª• th·ªÉ | ‚úÖ | `activity_registration:READ` |
| GET | `/api/activities/:id` | L·∫•y chi ti·∫øt ho·∫°t ƒë·ªông theo ID | ‚ùå | - (Public) |
| POST | `/api/activities` | T·∫°o ho·∫°t ƒë·ªông m·ªõi | ‚úÖ | `activity:CREATE` |
| PUT | `/api/activities/:id` | C·∫≠p nh·∫≠t th√¥ng tin ho·∫°t ƒë·ªông | ‚úÖ | `activity:UPDATE` |
| DELETE | `/api/activities/:id` | X√≥a ho·∫°t ƒë·ªông | ‚úÖ | `activity:DELETE` |
| PUT | `/api/activities/:id/approve` | Ph√™ duy·ªát ho·∫°t ƒë·ªông | ‚úÖ | `activity:APPROVE` |
| PUT | `/api/activities/:id/reject` | T·ª´ ch·ªëi ho·∫°t ƒë·ªông | ‚úÖ | `activity:REJECT` |
| PUT | `/api/activities/:id/complete` | ƒê√°nh d·∫•u ho√†n th√†nh ho·∫°t ƒë·ªông | ‚úÖ | `activity:UPDATE` |
| POST | `/api/activities/:id/register` | ƒêƒÉng k√Ω tham gia ho·∫°t ƒë·ªông | ‚úÖ | `activity_registration:CREATE` |
| GET | `/api/activities/:id/registrations` | L·∫•y danh s√°ch ƒëƒÉng k√Ω c·ªßa ho·∫°t ƒë·ªông | ‚úÖ | `activity_registration:READ` |

**Request Body - Create Activity:**
```json
{
  "name": "Ho·∫°t ƒë·ªông t√¨nh nguy·ªán",
  "description": "M√¥ t·∫£ ho·∫°t ƒë·ªông",
  "type": "faculty",
  "time": "2024-01-15T00:00:00.000Z",
  "location": "P101",
  "points": 5,
  "maxParticipants": 50,
  "requirements": "Y√™u c·∫ßu tham gia"
}
```

**Request Body - Reject Activity:**
```json
{
  "reason": "L√Ω do t·ª´ ch·ªëi ho·∫°t ƒë·ªông"
}
```

**Response - Get My Activities (`/api/activities/my/activities`):**
```json
{
  "success": true,
  "data": [
    {
      "_id": "activity_id",
      "title": "Ho·∫°t ƒë·ªông t√¨nh nguy·ªán",
      "description": "M√¥ t·∫£ ho·∫°t ƒë·ªông",
      "location": "P101",
      "start_time": "2024-01-15T08:00:00.000Z",
      "end_time": "2024-01-15T12:00:00.000Z",
      "capacity": 50,
      "registration": {
        "id": "registration_id",
        "status": "approved",
        "registered_at": "2024-01-10T10:00:00.000Z"
      },
      "attendance": {
        "id": "attendance_id",
        "scanned_at": "2024-01-15T08:05:00.000Z",
        "status": "present",
        "verified": true,
        "points": 5,
        "feedback": "Ho√†n th√†nh t·ªët"
      }
    }
  ],
  "count": 1
}
```

**Response - Get Student Activities (`/api/activities/student/:studentId`):**
Same format as above.

---

### Registration Routes (`/api/registrations`)

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/registrations/my-registrations` | L·∫•y danh s√°ch ƒëƒÉng k√Ω c·ªßa t√¥i | ‚úÖ | - (Own data) |
| GET | `/api/registrations` | L·∫•y t·∫•t c·∫£ ƒëƒÉng k√Ω | ‚úÖ | `activity_registration:READ` |
| GET | `/api/registrations/activity/:activityId` | L·∫•y ƒëƒÉng k√Ω theo ho·∫°t ƒë·ªông | ‚úÖ | `activity_registration:READ` |
| GET | `/api/registrations/student/:studentId` | L·∫•y ƒëƒÉng k√Ω theo sinh vi√™n | ‚úÖ | `activity_registration:READ` |
| GET | `/api/registrations/:id` | L·∫•y chi ti·∫øt ƒëƒÉng k√Ω theo ID | ‚úÖ | `activity_registration:READ` |
| POST | `/api/registrations` | T·∫°o ƒëƒÉng k√Ω m·ªõi | ‚úÖ | `activity_registration:CREATE` |
| PUT | `/api/registrations/:id` | C·∫≠p nh·∫≠t ƒëƒÉng k√Ω | ‚úÖ | - (Own data) |
| DELETE | `/api/registrations/:id` | H·ªßy ƒëƒÉng k√Ω | ‚úÖ | `activity_registration:CANCEL` |
| PUT | `/api/registrations/:id/approve` | Ph√™ duy·ªát ƒëƒÉng k√Ω | ‚úÖ | `activity_registration:APPROVE` |
| PUT | `/api/registrations/:id/reject` | T·ª´ ch·ªëi ƒëƒÉng k√Ω | ‚úÖ | `activity_registration:REJECT` |

**Request Body - Create Registration:**
```json
{
  "activityId": "activity_uuid_here",
  "studentId": "student_uuid_here",
  "note": "Ghi ch√∫ ƒëƒÉng k√Ω"
}
```

**Request Body - Reject Registration:**
```json
{
  "reason": "L√Ω do t·ª´ ch·ªëi ƒëƒÉng k√Ω"
}
```

---

### Attendance Routes (`/api/attendances`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/attendances` | L·∫•y t·∫•t c·∫£ b·∫£n ghi ƒëi·ªÉm danh | ‚úÖ | admin, ctsv, teacher |
| GET | `/api/attendances/:id` | L·∫•y chi ti·∫øt ƒëi·ªÉm danh theo ID | ‚úÖ | - |
| GET | `/api/attendances/activity/:activityId` | L·∫•y ƒëi·ªÉm danh theo ho·∫°t ƒë·ªông | ‚úÖ | - |
| GET | `/api/attendances/student/:studentId` | L·∫•y ƒëi·ªÉm danh theo sinh vi√™n | ‚úÖ | - |
| POST | `/api/attendances` | T·∫°o b·∫£n ghi ƒëi·ªÉm danh m·ªõi | ‚úÖ | admin, ctsv, teacher, union |
| PUT | `/api/attendances/:id` | C·∫≠p nh·∫≠t ƒëi·ªÉm danh | ‚úÖ | admin, ctsv, teacher, union |
| DELETE | `/api/attendances/:id` | X√≥a ƒëi·ªÉm danh | ‚úÖ | admin, ctsv, teacher, union |
| PUT | `/api/attendances/:id/verify` | X√°c minh ƒëi·ªÉm danh | ‚úÖ | admin, ctsv, teacher, union |
| PUT | `/api/attendances/:id/feedback` | Th√™m ph·∫£n h·ªìi cho ƒëi·ªÉm danh | ‚úÖ | - |
| POST | `/api/attendances/scan-qr` | Qu√©t m√£ QR ƒë·ªÉ ƒëi·ªÉm danh | ‚úÖ | - |

**Request Body - Create Attendance:**
```json
{
  "activityId": "activity_uuid_here",
  "studentId": "student_uuid_here",
  "attendedAt": "2024-01-15T00:00:00.000Z",
  "note": "Ghi ch√∫ ƒëi·ªÉm danh"
}
```

**Request Body - Scan QR:**
```json
{
  "qrCode": "QR_CODE_DATA",
  "activityId": "activity_uuid_here"
}
```

---

### Post Routes (`/api/posts`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/posts` | L·∫•y t·∫•t c·∫£ b√†i ƒëƒÉng | ‚úÖ | - |
| GET | `/api/posts/:id` | L·∫•y chi ti·∫øt b√†i ƒëƒÉng theo ID | ‚úÖ | - |
| GET | `/api/posts/activity/:activityId` | L·∫•y b√†i ƒëƒÉng theo ho·∫°t ƒë·ªông | ‚úÖ | - |
| POST | `/api/posts` | T·∫°o b√†i ƒëƒÉng m·ªõi | ‚úÖ | admin, ctsv, teacher, union |
| PUT | `/api/posts/:id` | C·∫≠p nh·∫≠t b√†i ƒëƒÉng | ‚úÖ | admin, ctsv, teacher, union |
| DELETE | `/api/posts/:id` | X√≥a b√†i ƒëƒÉng | ‚úÖ | admin, ctsv, teacher, union |

**Request Body - Create Post:**
```json
{
  "activityId": "activity_uuid_here",
  "title": "Ti√™u ƒë·ªÅ b√†i ƒëƒÉng",
  "content": "N·ªôi dung b√†i ƒëƒÉng chi ti·∫øt",
  "images": ["image1.jpg", "image2.jpg"]
}
```

---

## ‚≠ê Points & Feedback

### Feedback Routes (`/api/feedback`)

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/feedback/my-feedbacks` | L·∫•y danh s√°ch ph·∫£n h·ªìi c·ªßa t√¥i | ‚úÖ | - (Own data) |
| GET | `/api/feedback` | L·∫•y t·∫•t c·∫£ ph·∫£n h·ªìi | ‚úÖ | `student_feedback:READ` |
| GET | `/api/feedback/activity/:activityId` | L·∫•y ph·∫£n h·ªìi theo ho·∫°t ƒë·ªông | ‚úÖ | `student_feedback:READ` |
| GET | `/api/feedback/:id` | L·∫•y chi ti·∫øt ph·∫£n h·ªìi theo ID | ‚úÖ | `student_feedback:READ` |
| POST | `/api/feedback` | T·∫°o ph·∫£n h·ªìi m·ªõi | ‚úÖ | - (Students) |
| PUT | `/api/feedback/:id` | C·∫≠p nh·∫≠t ph·∫£n h·ªìi | ‚úÖ | - (Own feedback) |
| DELETE | `/api/feedback/:id` | X√≥a ph·∫£n h·ªìi | ‚úÖ | `student_feedback:DELETE` |

**Request Body - Create Feedback:**
```json
{
  "activityId": "activity_uuid_here",
  "rating": 5,
  "comment": "Ho·∫°t ƒë·ªông r·∫•t hay v√† b·ªï √≠ch",
  "suggestions": "N√™n t·ªï ch·ª©c th√™m ho·∫°t ƒë·ªông t∆∞∆°ng t·ª±"
}
```

---

### Evidence Routes (`/api/evidences`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/evidences` | L·∫•y t·∫•t c·∫£ minh ch·ª©ng | ‚úÖ | admin, ctsv, khoa, loptruong |
| GET | `/api/evidences/:id` | L·∫•y chi ti·∫øt minh ch·ª©ng theo ID | ‚úÖ | - |
| POST | `/api/evidences` | T·∫°o minh ch·ª©ng m·ªõi | ‚úÖ | student |
| PUT | `/api/evidences/:id` | C·∫≠p nh·∫≠t minh ch·ª©ng | ‚úÖ | - |
| PUT | `/api/evidences/:id/approve` | Ph√™ duy·ªát minh ch·ª©ng | ‚úÖ | ctsv, khoa, loptruong |
| PUT | `/api/evidences/:id/reject` | T·ª´ ch·ªëi minh ch·ª©ng | ‚úÖ | ctsv, khoa, loptruong |
| DELETE | `/api/evidences/:id` | X√≥a minh ch·ª©ng | ‚úÖ | admin, ctsv |

**Request Body - Create Evidence:**
```json
{
  "student_id": "student_uuid_here",
  "title": "Minh ch·ª©ng tham gia ho·∫°t ƒë·ªông",
  "file_url": "https://example.com/files/certificate.pdf",
  "self_point": 5
}
```

**C√°c tr∆∞·ªùng trong Request:**
- `student_id` (required): ID c·ªßa sinh vi√™n
- `title` (required): Ti√™u ƒë·ªÅ minh ch·ª©ng
- `file_url` (optional): URL c·ªßa file minh ch·ª©ng
- `self_point` (optional): ƒêi·ªÉm t·ª± ƒë√°nh gi√° (m·∫∑c ƒë·ªãnh: 0)

**L∆∞u √Ω:** 
- `_id` s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông sinh b·ªüi MongoDB, kh√¥ng c·∫ßn truy·ªÅn t·ª´ client
- ƒê√¢y l√† minh ch·ª©ng cho ho·∫°t ƒë·ªông ngo√†i tr∆∞·ªùng, kh√¥ng li√™n k·∫øt v·ªõi activity trong h·ªá th·ªëng

**Request Body - Reject Evidence:**
```json
{
  "reason": "L√Ω do t·ª´ ch·ªëi minh ch·ª©ng"
}
```

---

## üîê System & Permissions

### Permission Routes (`/api/permissions`)

#### Permission Management

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/permissions` | L·∫•y t·∫•t c·∫£ permissions | ‚úÖ | - |
| POST | `/api/permissions` | T·∫°o permission m·ªõi | ‚úÖ | `permission:CREATE` |

**Request Body - Create Permission:**
```json
{
  "name": "New Permission",
  "description": "M√¥ t·∫£ quy·ªÅn m·ªõi"
}
```

#### Action Management

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/permissions/actions` | L·∫•y t·∫•t c·∫£ actions | ‚úÖ | - |
| POST | `/api/permissions/actions` | T·∫°o action m·ªõi | ‚úÖ | `permission:CREATE` |
| GET | `/api/permissions/actions/:resource` | L·∫•y actions theo resource | ‚úÖ | - |

**Request Body - Create Action:**
```json
{
  "name": "NEW_ACTION",
  "resource": "activity",
  "description": "M√¥ t·∫£ action m·ªõi"
}
```

#### User Permission Management

| Method | Endpoint | Description | Auth Required |
|--------|----------|-------------|---------------|
| GET | `/api/permissions/users/:userId/permissions` | L·∫•y t·∫•t c·∫£ permissions c·ªßa user | ‚úÖ |
| GET | `/api/permissions/users/:userId/actions/:resource` | L·∫•y actions c·ªßa user cho resource | ‚úÖ |
| POST | `/api/permissions/users/:userId/check-permission` | Ki·ªÉm tra permission c·ªßa user | ‚úÖ |

**Request Body - Check Permission:**
```json
{
  "resource": "activity",
  "action": "CREATE"
}
```

#### Role Permission Management

| Method | Endpoint | Description | Auth Required | Permission Required |
|--------|----------|-------------|---------------|---------------------|
| GET | `/api/permissions/roles` | L·∫•y t·∫•t c·∫£ roles | ‚úÖ | - |
| GET | `/api/permissions/roles/:roleId/actions` | L·∫•y actions c·ªßa role | ‚úÖ | - |
| POST | `/api/permissions/roles/:roleId/actions` | Th√™m action v√†o role | ‚úÖ | `role:UPDATE` |
| DELETE | `/api/permissions/roles/:roleId/actions/:actionId` | X√≥a action kh·ªèi role | ‚úÖ | `role:UPDATE` |

**Request Body - Add Action to Role:**
```json
{
  "action_id": "action_uuid_here"
}
```

---

### Role Routes (`/api/roles`)

| Method | Endpoint | Description | Auth Required | Roles |
|--------|----------|-------------|---------------|-------|
| GET | `/api/roles` | L·∫•y t·∫•t c·∫£ vai tr√≤ | ‚úÖ | admin, ctsv |
| GET | `/api/roles/:id` | L·∫•y vai tr√≤ theo ID | ‚úÖ | admin, ctsv |
| GET | `/api/roles/name/:name` | L·∫•y vai tr√≤ theo t√™n | ‚úÖ | admin, ctsv |
| GET | `/api/roles/:id/users` | L·∫•y ng∆∞·ªùi d√πng theo vai tr√≤ | ‚úÖ | admin, ctsv |
| POST | `/api/roles` | T·∫°o vai tr√≤ m·ªõi | ‚úÖ | admin |
| PUT | `/api/roles/:id` | C·∫≠p nh·∫≠t vai tr√≤ | ‚úÖ | admin |
| DELETE | `/api/roles/:id` | X√≥a vai tr√≤ | ‚úÖ | admin |
| POST | `/api/roles/:id/permissions` | Th√™m quy·ªÅn v√†o vai tr√≤ | ‚úÖ | admin |
| DELETE | `/api/roles/:id/permissions` | X√≥a quy·ªÅn kh·ªèi vai tr√≤ | ‚úÖ | admin |

**Request Body - Create Role:**
```json
{
  "name": "New Role",
  "description": "M√¥ t·∫£ vai tr√≤ m·ªõi"
}
```

---

## üîë Authentication

H·∫ßu h·∫øt c√°c endpoints y√™u c·∫ßu authentication token trong header:

```
Authorization: Bearer <PLOK>
```

### L·∫•y Token

1. ƒêƒÉng nh·∫≠p qua `/api/auth/login`
2. Nh·∫≠n token t·ª´ response
3. S·ª≠ d·ª•ng token trong header cho c√°c requests ti·∫øp theo

---

## üë• Role-based Access Control

H·ªá th·ªëng c√≥ **4 roles ch√≠nh**:

| Role | Description | S·ªë l∆∞·ª£ng Permissions |
|------|-------------|---------------------|
| `admin` | Qu·∫£n tr·ªã vi√™n h·ªá th·ªëng - To√†n quy·ªÅn | ~82 permissions |
| `staff` | C√°n b·ªô (CTSV, ƒêo√†n, H·ªôi SV, Khoa, CLB) - Qu·∫£n l√Ω sinh vi√™n v√† ho·∫°t ƒë·ªông | ~55 permissions |
| `teacher` | Gi·∫£ng vi√™n - Qu·∫£n l√Ω l·ªõp, ch·∫•m ƒëi·ªÉm, duy·ªát minh ch·ª©ng | ~35 permissions |
| `student` | Sinh vi√™n - Tham gia ho·∫°t ƒë·ªông, n·ªôp minh ch·ª©ng | ~17 permissions |

**L∆∞u √Ω ƒë·∫∑c bi·ªát:**
- **Staff** ƒë∆∞·ª£c ph√¢n bi·ªát qua `org_unit_id` trong `user_role` (CTSV, ƒêo√†n tr∆∞·ªùng, Khoa, CLB)
- **L·ªõp tr∆∞·ªüng** KH√îNG ph·∫£i role ri√™ng, m√† l√† field `isClassMonitor: true` trong `student_profile`
- **L·ªõp tr∆∞·ªüng** c√≥ th√™m 2 quy·ªÅn: `class:attendance` v√† `class:report` (c·∫ßn middleware `checkClassMonitor()`)

---

## üìå HTTP Status Codes

| Code | Meaning |
|------|---------|
| 200 | OK - Request th√†nh c√¥ng |
| 201 | Created - T·∫°o m·ªõi th√†nh c√¥ng |
| 400 | Bad Request - D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá |
| 401 | Unauthorized - Ch∆∞a ƒëƒÉng nh·∫≠p |
| 403 | Forbidden - Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p |
| 404 | Not Found - Kh√¥ng t√¨m th·∫•y |
| 500 | Internal Server Error - L·ªói server |

---

## üì± Test Accounts

Sau khi ch·∫°y `seed_correct_structure.js`, b·∫°n c√≥ **10 users** cho ƒë·∫ßy ƒë·ªß 4 roles:

### üëë Admin (1 account)
| Username | Password | Role | M√¥ t·∫£ |
|----------|----------|------|-------|
| `admin` | `admin123` | admin | Qu·∫£n tr·ªã vi√™n h·ªá th·ªëng - To√†n quy·ªÅn |

### üëî Staff (3 accounts)
| Username | Password | Role | Org Unit | M√¥ t·∫£ |
|----------|----------|------|----------|-------|
| `staff_ctsv` | `staff123` | staff | Ph√≤ng CTSV | C√°n b·ªô C√¥ng t√°c sinh vi√™n |
| `staff_doan` | `staff123` | staff | ƒêo√†n tr∆∞·ªùng | C√°n b·ªô ƒêo√†n tr∆∞·ªùng |
| `staff_khoa` | `staff123` | staff | Khoa CNTT | C√°n b·ªô Khoa CNTT |

### üë®‚Äçüè´ Teacher (2 accounts)
| Username | Password | Role | M√¥ t·∫£ |
|----------|----------|------|-------|
| `teacher1` | `teacher123` | teacher | Gi·∫£ng vi√™n A (GV001) |
| `teacher2` | `teacher123` | teacher | Gi·∫£ng vi√™n B (GV002) |

### üë®‚Äçüéì Student (4 accounts)
| Username | Password | Role | Student Number | ƒê·∫∑c bi·ªát |
|----------|----------|------|----------------|----------|
| `student1` | `student123` | student | 102220001 | Sinh vi√™n th∆∞·ªùng |
| `student2_monitor` | `student123` | student | 102220002 | **L·ªöP TR∆Ø·ªûNG ‚≠ê** (isClassMonitor: true) |
| `student3` | `student123` | student | 102220003 | Sinh vi√™n th∆∞·ªùng |
| `student4` | `student123` | student | 102220004 | Sinh vi√™n th∆∞·ªùng |

### Login Format
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Note:** 
- Database: `Community_Activity_Management`
- **T·∫•t c·∫£ passwords ƒë√£ ƒë∆∞·ª£c hash b·∫±ng bcrypt** trong seed file (saltRounds = 10)
- L·ªõp tr∆∞·ªüng ƒë∆∞·ª£c x√°c ƒë·ªãnh qua field `isClassMonitor: true` trong `student_profile`, KH√îNG ph·∫£i role ri√™ng

